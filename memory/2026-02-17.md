# 2026-02-17 â€” Blofin Feedback Loop & Ranking Overhaul

## Session Work

### 1. Strategy Ranking Metrics (Research Complete)
**Problem:** Win rate alone is misleading. A 40% win rate with big winners beats 70% with small winners.

**Solution:** Composite Entry+Exit Package Score (EEP)
- **Entry metrics (60%):** 30% Profit Factor + 25% Sharpe + 20% Max DD + 15% Sortino + 10% Expectancy
- **Exit metrics (40%):** % of max profit captured (MPC), R:R realization, stop-hit frequency (SHF), breakeven stop utilization (BEUR)
- **Hard gates:** PF â‰¥ 1.3, Sharpe â‰¥ 0.8, MDD â‰¤ 35%, Trades â‰¥ 30, positive expectancy

Replaced win-rate-only ranking with this system. Now integrated into optimizer.

### 2. Exit Strategy Impact (Research Complete)
**Key insight:** Exits are as important as entries. A brilliant entry with poor exit = loss. A mediocre entry with disciplined exit = profit.

Example: NVDA trailing stop at 10% captured +21.5%, but 20% trailing stop captured only +8% â€” 2.7x difference on identical entry.

**Critical metrics:**
- MPC (% of max profit captured): >65% is good
- SHF (stop hit frequency): <20% means stops not being hunted
- BEUR (breakeven stop usage): >70% eliminates "win-that-became-loss" trades

### 3. Paper Trading Feedback Loop (2-Phase Approach)
**Phase 1 (Now - Immediate):** Execution Calibrator
- Learns actual slippage, fill rates, hold times from closed paper trades
- Zero look-ahead bias (closed trades only)
- Updates position sizing dynamically

**Phase 2 (After 2 weeks + 75 trades):** ML Retrain with Safety Gates
- Regime diversity check (volatility percentile must span 20th-80th range)
- A/B test minimum 100 trades per arm before accepting new model
- Conservative 1.5-2x slippage multiplier until 6 weeks of data

**Why 2 weeks not 4:** Rob's call to accelerate. Validated by Opus reviewer with guardrails above.

### 4. Reality Gap: Paper Trading Revelations
From 33,444 closed paper trades:
- **Actual slippage:** 0.052%/side (vs 0.02% assumed) = 2.6x worse
- **Stop-hit frequency:** 47.2% of stops hit, then price reversed back (stops placed at obvious levels)
- **Average hold time:** 104.6 min (vs 60 min assumed)
- **Fill rate:** 67% (not 100%)
- **Overall paper PnL:** Unprofitable (PF=0.74)

**Actionable:** Stops too tight. Increase SL by 10-75bps to avoid algo stop-hunting.

### 5. Top 3 Strategies Ready
From optimizer run (Feb 16 23:34):
1. **mtf_trend_align / SHIB-USDT [5m/1h]** â€” 81.8% WR, 16.74 Sharpe, +9.76% PnL
2. **ml_gbt_5m / ETH-USDT [5m]** â€” 71.0% WR, 7.62 Sharpe, +42.3% PnL
3. **mtf_momentum_confirm / JUP-USDT [15m/4h]** â€” 76.9% WR, 8.56 Sharpe, +29.28% PnL

These are what Phase 2 (2-week paper) should focus on validating. Once proven, can slow research down significantly.

### 6. Dashboard Fix
**Problem:** Dashboard showing stale library backtest data (negative PnL strategies).

**Root cause:** Optimizer saved results to JSON but API read from old database tables.

**Fix:** 
- Created sync process (sync_optimizer_to_db.py) to read latest optimizer_results_*.json and write to DB
- Dashboard now shows correct winning strategies
- API endpoints return optimizer results with source field

**Secondary fix:** Dashboard was using 599% CPU due to no caching. Added TTL-based cache (5-30s) to all endpoints. Now running at 103% CPU.

## Key Decisions
1. **Accelerate Phase 2:** 2 weeks instead of 4, with safety gates
2. **EEP scoring:** Replace win rate with composite metric system-wide
3. **Top 3 focus:** Once proven in 2-week paper trading, research drops to maintenance mode
4. **Conservative early:** Use 1.5-2x slippage multiplier and position size caps until 6+ weeks of paper data

## Implementation Status (Feb 17 08:28)

**Phase 1: LIVE** âœ…
- Execution calibrator running, learning from 33.4K paper trades
- Learning actual slippage (0.052%), fill rates (67%), hold times (104.6 min)
- Position sizing multipliers being calculated dynamically

**Phase 2: IN PROGRESS** ðŸ”¨
- Builder spawned to implement full Phase 2 ML retrain framework
- Scope: regime diversity gates, embargo windows, A/B testing, EMA slippage tracking
- Full EEP scoring (all 7 metrics, not placeholders)
- Cron jobs for daily retrain trigger (06:00 MST) + A/B decision (18:00 MST)
- Expected delivery: ~15 min

**Dashboard: FIXED** âœ…
- Resolved 540% CPU issue with query optimization + caching
- Now running at 4% CPU with all stats displayed
- Sorting fixed: positive PNL strategies ranked first, then by Sharpe
- EEP-based ranking integrated

**Cron Activities:**
- 08:00 MST morning pruning: Disabled 81 low-confidence strategies (WR<35%, negative Sharpe)
- Portfolio reduced 314 â†’ 233 active strategies
- Momentum/BTC on watch list (100% WR on 2 trades, needs confirmation)
- Parameter sweep scheduled 10:00 MST, Librarian check at 12:00 MST

## Next Steps
- Wait for Phase 2 builder to complete implementation
- Monitor execution calibrator learning as paper trades accumulate
- At 2-week + 75-trade mark, Phase 2 will trigger automatically
- Top 3 strategies continue in paper trading validation

## Critical Insight
The paper trading reality gap (2.6x worse slippage, 47% stop-hit frequency) is the exact feedback loop that Phase 1 is learning. As execution calibrator refines, models will get more accurate. Stop placement needs adjustment (10-75bps wider) to avoid algo hunting.
