# 2026-02-12

## Blofin Dashboard Initial Fix (07:29-07:55 MST)

- User reported Blofin dashboard issue at `http://127.0.0.1:8780/` ("isn't loading right" / appeared frozen).
- Diagnosis: `blofin-stack-api.service` was running an older `api_server.py` process (stale in-memory code), so dashboard UI looked outdated.
- Fix applied: restarted `blofin-stack-api.service` via systemd user service.
- Verification after restart:
  - `http://127.0.0.1:8780/healthz` returned `ok`
  - `/` served updated dashboard HTML (Live Feed + coverage cards present)
  - `/api/summary` returned valid JSON.
- User was advised to hard refresh browser (`Ctrl+Shift+R`) if stale page persisted in cache.

## Blofin Websocket Fix (07:47-07:51 MST)

- Dashboard showed stale data because websocket ingestor was failing silently.
- Root cause: Blofin API rejected oversized subscribe payloads (25 symbols in one message) with error `60012 Invalid request`.
- Fix: Updated `ingestor.py` to batch subscriptions (8 symbols per request with 150ms delay).
- Restarted `blofin-stack-ingestor.service`.
- Verification: live feed resumed, ticks updating continuously.
- Committed: `892cbe6` — Fix Blofin ingestor subscribe payload by batching symbols.

## Blofin Symbol & Throttle Fixes (07:53-08:19 MST)

- User requested: throttle API calls to Blofin for backfill, remove unavailable symbols.
- Actions:
  - Removed unavailable symbols from `.env`: `FLOKI-USDT`, `BONK-USDT`, `DOGS-USDT` (not listed on Blofin).
  - Updated `historical_backfill.py`:
    - Added throttle controls: `BACKFILL_REQUEST_SLEEP_MS=400`, `BACKFILL_SYMBOL_SLEEP_MS=1000`.
    - Reduced batch size to `BACKFILL_BATCH_LIMIT=60`.
    - Fixed symbol resolution: map ws-style ids (`BTC-USDT`) to CCXT symbols (`BTC/USDT:USDT`).
    - Skip unavailable symbols gracefully.
    - Fixed market loading bug (missing `ex.load_markets()`).
    - Switched from `until` to `since` pagination for better compatibility.
- Restarted services: `blofin-stack-ingestor.service`, `blofin-stack-api.service`.
- Dashboard now shows 22 symbols (down from 25), live feed stable.
- Committed: `002fe10` — Throttle Blofin backfill requests and harden symbol handling.

## Blofin Full Cleanup (10:47-10:49 MST)

- User complaint: Blofin dashboard has "kanban stuff" on it, multiple versions of Blofin code exist, messy structure.
- Claude Code found issues with `blofin-research`.
- Full audit revealed cross-contamination:
  - **blofin-stack** contained BOTH Blofin trading code AND kanban automation code (kanban_server.py, kanban_worker.py, kanban_watchdog.py).
  - **blofin-research** was an old inactive version.
  - **blofin-dashboard** was a standalone dashboard (not running).
- Cleanup actions:
  1. Moved kanban files from `blofin-stack/` to `kanban-dashboard/`:
     - `kanban_server.py`, `kanban_worker.py`, `kanban_watchdog.py`.
  2. Created separate `kanban-dashboard/db.py` with kanban table definitions.
  3. Removed kanban tables/functions from `blofin-stack/db.py` (now Blofin-only).
  4. Deleted obsolete directories:
     - `blofin-research/`
     - `blofin-dashboard/`
  5. Disabled/removed obsolete systemd services:
     - `blofin-research.service`
     - `blofin-dashboard.service`
  6. Removed kanban health check from `blofin-stack/dashboard_health_check.py`.
- Restarted all Blofin services successfully.
- **Result**: Clean separation — `blofin-stack` is now Blofin-only, `kanban-dashboard` is separate.
- Committed: `cfe468c` — Clean up Blofin: remove kanban contamination, delete obsolete dirs.

## Blofin Data Coverage Investigation (10:55-11:05 MST)

- User requested: improve 7-day rolling backfill, ensure continuous good coverage.
- Investigation revealed **major API limitation**: Blofin REST API only returns ~1-2 hours of historical data, regardless of `since` parameter.
- Test: `fetch_ohlcv` with `since=7_days_ago` only returned most recent 100 minutes.
- **Implication**: Cannot backfill deep historical gaps from REST API.

**Coverage audit (7-day window):**
- Most symbols: ~16% coverage (1,640/10,080 minutes)
- PEPE-USDT: 99.2% (only one running continuously from live feed)
- Many old symbols (BTC, ETH, SOL, etc.): 0.1% (ancient data, not in current feed)

**Root cause:**
- Coverage depends entirely on websocket uptime
- REST backfill can only fill tiny recent gaps (last 1-2 hours max)
- The 7-day window will only be complete if ingestor runs continuously

**Actions taken:**
1. Reduced `BACKFILL_LOOKBACK_DAYS` from 7 to 1 (realistic limit)
2. Created `DATA_COVERAGE.md` documenting the limitation
3. Updated `.env.example` with realistic expectations
4. Committed changes

**Key insight:** This is an **API constraint**, not a code bug. Blofin doesn't provide deep historical OHLCV via REST.

## Blofin Coverage Fix & Dashboard Update (10:55-11:10 MST)

User requested verification that Blofin is clean and proper 7-day rolling backfill.

**Audit findings:**
1. ✅ Blofin structure is clean (no kanban contamination in code)
2. ⚠️ Kanban tables still existed in DB (created before cleanup) — **fixed by dropping them**
3. ⚠️ Dashboard showed misleading "16% coverage" over 7 days

**Root cause analysis:**
- Most symbols only have data from **Feb 11** (yesterday), not 7 days back
- Only PEPE has data from Feb 5 (7 days ago)
- Measuring coverage against a fixed 7-day window was misleading
- **Actual coverage since each symbol's start date: 99-100%**

**Data availability:**
- PEPE: 171.5h active (99.2% coverage, 85 missing minutes)
- Most others: 27.5h active (100% coverage, 0-1 missing minutes)
- **Backfill is working perfectly** — all available data is filled

**Fixes applied:**
1. Dropped `kanban_tasks`, `kanban_events`, `kanban_task_events` from Blofin DB
2. Fixed `BACKFILL_MAX_GAP_MINUTES` from 0 to 1440 (was preventing gap splitting)
3. Added new dashboard metric: **"coverage since start"** instead of fixed 7-day window
4. Updated dashboard UI to show:
   - "Data Quality: GOOD" (worst 99.2%)
   - Table showing hours active + coverage % for each symbol
5. Updated JavaScript refresh to use realistic metric

**Verification:**
- Dashboard health: `WARN` (99.17% worst coverage — accurate)
- All symbols have 99-100% coverage since they became available
- Live feed: ✅ working
- Backfill: ✅ working (filling remaining small gaps)

**Committed:** Added realistic coverage metrics to Blofin dashboard

## Blofin Architecture (Final State)

**Active Blofin Services** (on `blofin-stack`):
- `blofin-stack-ingestor.service` — websocket → sqlite (ticks + signals)
- `blofin-stack-api.service` — dashboard on `:8780`
- `blofin-stack-paper.service` — paper trading engine
- `blofin-stack-gapfill.timer` — historical backfill (every 30min)

**Database**: `/home/rob/.openclaw/workspace/blofin-stack/data/blofin_monitor.db`

**Symbols** (22 total, all verified available on Blofin):
PEPE-USDT, SHIB-USDT, WIF-USDT, BOME-USDT, MEME-USDT, NOT-USDT, ORDI-USDT, JTO-USDT, JUP-USDT, PYTH-USDT, SEI-USDT, SUI-USDT, TIA-USDT, APT-USDT, ARB-USDT, OP-USDT, INJ-USDT, RUNE-USDT, NEAR-USDT, FIL-USDT, AAVE-USDT, ETC-USDT

**Key Fixes**:
- Batched websocket subscriptions (8 symbols/batch).
- Throttled backfill requests (400ms between requests, 1s between symbols).
- Symbol validation against Blofin markets.
- Removed kanban contamination completely.
