# 2026-02-21 — Daily Log

## Blofin volatility strategy
- Spawned builder (sonnet) to design a volatility-based strategy tailored to the ranging_low_volatility regime; instructions required VWAP mean-reversion cues with Bollinger/ATR gating while avoiding volume mean reversion patterns.
- Builder produced `blofin-stack/strategies/volatility_low_vol_vwap_bollinger.py` with the requested template (5m timeframe, VWAP/Bollinger/ATR logic, RSI gating, low-vol volatility heuristics).
- Updated status.json to mark the task as Review/Test and noted the file creation; awaiting QA review per process notes.

## 21:10 MST — Campsite CRM restored on localhost:3000
- Root cause: shell-level `PORT=8787` (and `HOST=127.0.0.1`) forced both CRM services onto the Kanban port, causing startup collisions.
- Fixes applied in repo:
  - `backend/package.json`: `start`/`dev` now pin `PORT=5000`.
  - `frontend/package.json`: `start` now runs `env -u HOST PORT=3000 react-scripts start`.
- Relaunched services detached with logs in `/tmp` and verified:
  - `GET http://localhost:5000/health` → 200 + `{\"status\":\"OK\"...}`
  - `GET http://localhost:3000/` → HTTP 200.

## 22:44 MST — Campsite CRM restored (frontend+backend)
- Verified frontend at `http://localhost:3000` was up but backend `http://localhost:5000` was down (`ECONNREFUSED` via `/api/*` proxy).
- Confirmed endpoint mismatch in code: frontend requested `/api/bookings/arrival-radar` while backend primary route was `/api/bookings/upcoming`.
- Fixes applied:
  - `frontend/src/App.jsx`: switched to `/api/bookings/upcoming`.
  - `backend/server.js`: added backward-compatible alias `/api/bookings/arrival-radar` -> same handler as `/api/bookings/upcoming`.
- Relaunched backend and verified end-to-end through frontend proxy:
  - `GET /api/bookings/upcoming` via `:3000` -> 200
  - `GET /api/bookings/arrival-radar` via `:3000` -> 200
  - `GET /api/dashboard/summary` via `:3000` -> 200

## 08:15 MST — Campsite CRM made always-on with systemd
- Diagnosed downtime at `http://localhost:3000` as process-lifecycle issue: no persistent process manager was running for campsite-crm.
- Implemented stable single-service runtime:
  - `backend/server.js` now supports `SERVE_FRONTEND_BUILD=1` and serves `frontend/build` + SPA fallback for non-API routes.
  - Added `scripts/start-live.sh` to launch production mode on `PORT=3000` and auto-build frontend once if missing.
  - Added `scripts/install-systemd-user.sh` to install `~/.config/systemd/user/campsite-crm.service` with `Restart=always`.
- Installed/enabled service and validated:
  - `systemctl --user is-enabled campsite-crm.service` -> enabled
  - Repeated health checks on `/health` -> 200
  - UI root `/` -> 200
  - Forced crash test (`kill -9` main PID) auto-recovered and returned to healthy 200.

## 08:57 MST — Campsite CRM booking-assistant features added
- Researched major campsite booking apps (Hipcamp, The Dyrt, Campspot, Recreation.gov) and mapped recurring user-side booking needs into five features.
- Added backend endpoints in `backend/server.js`:
  - `GET /api/booking-assistant/availability` (availability + amenity matching + alternative dates)
  - `POST /api/booking-assistant/cost-estimate` (full price breakdown + deposit due)
  - `GET /api/booking-assistant/cancellation-preview` (refund windows and examples)
- Added frontend booking flow:
  - New tab in `frontend/src/App.jsx`: `Booking Assistant`
  - New component `frontend/src/components/BookingAssistant.jsx`
  - New styling `frontend/src/styles/BookingAssistant.css`
- Validation:
  - `npm run build` (frontend) passed
  - `node --check backend/server.js` passed
  - Live API smoke tests on port `5055` returned expected payloads for all three new endpoints.

## 09:38 MST — Campsite CRM contacts + Gmail suggestion workflow upgrade
- Added backend non-destructive Gmail scan endpoint: `POST /api/contacts/suggestions/from-live-gmail`.
  - Pulls live Gmail messages using saved Gmail token/settings.
  - Uses OpenAI scan when configured, falls back to heuristic extraction.
  - Returns deduplicated suggestions with existing-contact match metadata (`action: create|update`) without writing contacts yet.
- Improved summary merge endpoint `POST /api/contacts/merge-recent-summaries` so it also updates `contacts.last_conversation_at` using latest recent conversation date per contact.
- Added Contacts UI workflow for Gmail suggestions:
  - Scan controls (window days + max messages)
  - Select suggestions and apply to CRM via `POST /api/contacts/suggestions/apply`
  - One-click recent summary merge action from Contacts page
- Validation completed:
  - `node --check backend/server.js` passed
  - `npm --prefix frontend run build` passed
  - Health checks passed on both ports:
    - `GET http://127.0.0.1:3000/health` -> 200
    - `GET http://127.0.0.1:5000/health` -> 200
